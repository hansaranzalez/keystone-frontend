version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
        # Create a valid amplify hosting manifest
        - |
          cat > .output/public/deploy-manifest.json << EOL
          {
            "version": 1,
            "routes": [
              {
                "path": "/_nuxt/*",
                "cacheControl": "public, max-age=31536000, immutable"
              },
              {
                "path": "/*.*",
                "cacheControl": "public, max-age=31536000, immutable"
              },
              {
                "path": "/*",
                "handler": "index.html",
                "origin": {
                  "originPath": ""
                }
              }
            ]
          }
          EOL
  artifacts:
    baseDirectory: .output/public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*